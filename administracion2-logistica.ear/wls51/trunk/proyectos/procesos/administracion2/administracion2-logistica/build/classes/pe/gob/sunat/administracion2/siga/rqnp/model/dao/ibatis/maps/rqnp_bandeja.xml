<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="rqnpbandeja">
	<typeAlias alias="rqnpBandejaBean"
		type="pe.gob.sunat.administracion2.siga.rqnp.model.domain.RqnpBandejaBean" />
	
	<resultMap id="lstbandeja" class="rqnpBandejaBean">
		<result property="cod_rqnp_ext" 		column="COD_RQTO_NO_PROG" />
		<result property="fec_rqnp" 			column="FECH_REQU_SRM" />
		<result property="nom_sol" 				column="SOLICITANTE" />
		<result property="uuoo_sol" 			column="UUOO_SOLICITANTE" />
		<result property="motivo_sol" 			column="MOTI_SOLI_SRM" />
		<result property="cod_resp" 			column="CODI_RESP_SRM" />
		<result property="cod_dep" 				column="CODI_DEPE_TDE" />
		<result property="cod_bien" 			column="CODI_BSER_CAT" />
		<result property="des_bien" 			column="DES_BBSS_NUEVO" />
		<result property="cod_unid" 			column="UNID_MEDI_DSR" />
		<result property="unid_bien" 			column="UM_NUEVO" />
		<result property="cantidad" 			column="CANT_TOTA_DSR" />
		<result property="prec_bien" 			column="PUNI_NACI_DSR" />
		<result property="prec_total" 			column="TOTAL" />
		<result property="cod_bien_orig" 		column="COD_ITEMORIGEN" />
		<result property="des_bien_orig" 		column="DESC_BBSS_ORIGEN" />
		<result property="unid_bien_orig" 		column="UM_ORIGEN" />
		<result property="auct_modifico" 		column="AUCT_MODIFICO" />
		<result property="user_modifco" 		column="USERMODIFICO" />
		<result property="fec_modifico" 		column="FEC_ITEMMODIFICADO" />
		<result property="cod_auct_mod" 		column="COD_AUCTMODIFICO" />
		<result property="cod_user_mod" 		column="COD_USERMODIFICO" />
		<result property="cod_rqnp" 			column="CODI_RQNP_SRM" />
		<result property="cod_clas" 			column="CLASIFICADOR" />
		<result property="cod_estado" 			column="IND_ESTADO" />
		<result property="des_estado" 			column="DESC_REGI_EST" />
		<result property="obs_rechazo" 			column="OBS_RECHAZO" />
		<result property="ind_especializado" 	column="IND_ESPECIALIZADO" />
		<result property="saldo" 				column="SALDO" />
		<result property="name_auct" 			column="NAME_AUCT" />
		<result property="numeroArchivo" 		column="NUM_ARCHIVO" />
		<result property="anio_atencion" 		column="ANN_ATENCION" />
		<result property="mes_atencion" 		column="MES_ATENCION" />
	</resultMap>

	<select id="selectJefeInmediato" parameterClass="java.util.HashMap" resultMap="lstbandeja">
		SELECT
			REQUERIMIENTO_NO_PROG.COD_RQTO_NO_PROG,
			REQUERIMIENTO_NO_PROG.FECH_REQU_SRM,
			MP2.NOMB_CORT_PER AS SOLICITANTE,
			DEPE2.UNIDAD_ORGANIZACIONAL||' '||DEPE2.abreviatura AS UUOO_SOLICITANTE,
			REQUERIMIENTO_NO_PROG.MOTI_SOLI_SRM,
			REQUERIMIENTO_NO_PROG.CODI_RESP_SRM,
			REQUERIMIENTO_NO_PROG.CODI_DEPE_TDE,
			REQUERIMIENTO_NO_PROG_BIENES.CODI_BSER_CAT,
			CAT2.DESC_BSER_CAT AS DES_BBSS_NUEVO,
			REQUERIMIENTO_NO_PROG_BIENES.UNID_MEDI_DSR,
			UM1.UNID_MEDI_UND AS UM_NUEVO,
			REQUERIMIENTO_NO_PROG_BIENES.CANT_TOTA_DSR,
			REQUERIMIENTO_NO_PROG_BIENES.PUNI_NACI_DSR,
			(REQUERIMIENTO_NO_PROG_BIENES.CANT_TOTA_DSR * REQUERIMIENTO_NO_PROG_BIENES.PUNI_NACI_DSR) AS TOTAL, 
			REQUERIMIENTO_NO_PROG_BIENES.COD_ITEMORIGEN,
			CAT1.DESC_BSER_CAT AS DESC_BBSS_ORIGEN,
			UM2.UNID_MEDI_UND AS UM_ORIGEN,
			DEPE1.UNIDAD_ORGANIZACIONAL||' '||DEPE1.DESC_DEPE_TDE AS AUCT_MODIFICO,
			MP1.NOMB_CORT_PER AS USERMODIFICO,
			REQUERIMIENTO_NO_PROG_BIENES.FEC_ITEMMODIFICADO,
			REQUERIMIENTO_NO_PROG_BIENES.COD_AUCTMODIFICO,
			REQUERIMIENTO_NO_PROG_BIENES.COD_USERMODIFICO,
			REQUERIMIENTO_NO_PROG_BIENES.CODI_RQNP_SRM,
			REQUERIMIENTO_NO_PROG_BIENES.CLASIFICADOR,
			REQUERIMIENTO_NO_PROG_BIENES.IND_ESTADO,
			SYS_ESTADOS.DESC_REGI_EST,
			REQUERIMIENTO_NO_PROG_BIENES.OBS_RECHAZO,
			REQUERIMIENTO_NO_PROG_BIENES.IND_ESPECIALIZADO,
			(SELECT SER_RNP.FN_SALDO_CD (REQUERIMIENTO_NO_PROG.ANO_PROC_SRM,REQUERIMIENTO_NO_PROG_BIENES.COD_PLAZA,REQUERIMIENTO_NO_PROG_BIENES.CODI_BSER_CAT) AS RESULTADO FROM DUAL)  SALDO ,
			TDAUC.UNIDAD_ORGANIZACIONAL || ' - ' || TDAUC.ABREVIATURA NAME_AUCT,
			REQUERIMIENTO_NO_PROG_BIENES.NUM_ARCHIVO,
			NVL(REQUERIMIENTO_NO_PROG.ANN_ATENCION, REQUERIMIENTO_NO_PROG.ANO_PROC_SRM) ANN_ATENCION,
			DECODE (NVL(REQUERIMIENTO_NO_PROG.MES_ATENCION,REQUERIMIENTO_NO_PROG.MES_PROC_SRM ), '01', 'ENERO','02','FEBEREO','03','MARZO','04','ABRIL','05','MAYO','06','JUNIO','07','JULIO','08','AGOSTO','09','SEPTIEMBRE','10','OCTUBRE','11','NOVIEMBRE','12','DICIEMBRE' ) MES_ATENCION
		FROM 
			(SELECT RB.CODI_BSER_CAT, RB.UNID_MEDI_DSR, RB.CANT_TOTA_DSR, RB.PUNI_NACI_DSR, RB.COD_ITEMORIGEN,
	                RB.FEC_ITEMMODIFICADO, RB.COD_AUCTMODIFICO, RB.COD_USERMODIFICO, RB.CODI_RQNP_SRM, RB.CLASIFICADOR, RB.IND_ESTADO, RB.OBS_RECHAZO, 
	                RB.IND_ESPECIALIZADO, RB.COD_PLAZA, RB.NUM_ARCHIVO, RB.COD_AUCT1, RB.COD_JEFE
	            FROM REQUERIMIENTO_NO_PROG_BIENES RB 
	            WHERE RB.IND_ESTADO IN ('03','04')) 
	            REQUERIMIENTO_NO_PROG_BIENES,   
			REQUERIMIENTO_NO_PROG,
			CATALOGO_BIEN_SERVICIO CAT1,
			CATALOGO_BIEN_SERVICIO CAT2,
			UNIDADES_DE_MEDIDAS UM1,
			UNIDADES_DE_MEDIDAS UM2,
			TDEPENDENCIAS DEPE1,
			TDEPENDENCIAS DEPE2,
			MAESTRO_PERSONAL MP1,
			MAESTRO_PERSONAL MP2,
			TDEPENDENCIAS TDAUC,
			SYS_ESTADOS
		WHERE
			TDAUC.CODI_DEPE_TDE=REQUERIMIENTO_NO_PROG_BIENES.COD_AUCT1
			AND REQUERIMIENTO_NO_PROG_BIENES.CODI_RQNP_SRM = REQUERIMIENTO_NO_PROG.CODI_RQNP_SRM 
			AND #cod_est# LIKE '%'||NVL(REQUERIMIENTO_NO_PROG_BIENES.IND_ESTADO,' ')||'%' 
			AND REQUERIMIENTO_NO_PROG_BIENES.CODI_BSER_CAT = CAT2.CODI_BSER_CAT
			AND REQUERIMIENTO_NO_PROG_BIENES.COD_ITEMORIGEN = CAT1.CODI_BSER_CAT
			AND CAT2.UNID_MUSO_CAT = UM1.CODI_MEDI_UND
			AND CAT1.UNID_MUSO_CAT = UM2.CODI_MEDI_UND
			AND REQUERIMIENTO_NO_PROG_BIENES.COD_AUCTMODIFICO = DEPE1.CODI_DEPE_TDE (+)
			AND REQUERIMIENTO_NO_PROG_BIENES.COD_USERMODIFICO = MP1.CODI_EMPL_PER (+)
			AND REQUERIMIENTO_NO_PROG.CODI_DEPE_TDE = DEPE2.CODI_DEPE_TDE
			AND REQUERIMIENTO_NO_PROG.CODI_RESP_SRM = MP2.CODI_EMPL_PER
			AND SYS_ESTADOS.NOMB_TABL_EST = 'REQUERIMIENTO_NO_PROG_BIENES'
			AND REQUERIMIENTO_NO_PROG_BIENES.IND_ESTADO = SYS_ESTADOS.VALO_ESTA_EST
			<isNotNull prepend="AND" property="codEmpleadoJefe"> SER_RNP.FN_JEFE_INMEDIATO(REQUERIMIENTO_NO_PROG.CODI_RESP_SRM) = #codEmpleadoJefe#</isNotNull>
			<isNotNull prepend="AND" property="codEmpleadoEncargado"> SER_RNP.FN_JEFE_INMEDIATO_ENCARGADO(REQUERIMIENTO_NO_PROG.CODI_RESP_SRM, #codEmpleadoEncargado#) = #codEmpleadoEncargado#</isNotNull>
			<!--  ORDER BY REQUERIMIENTO_NO_PROG.FECH_REQU_SRM DESC,SOLICITANTE DESC ,COD_RQTO_NO_PROG DESC ,DES_BBSS_NUEVO DESC --> 
			ORDER BY REQUERIMIENTO_NO_PROG.CODI_RQNP_SRM DESC
	</select>


	<select id="selectItendente" parameterClass="java.util.HashMap" resultMap="lstbandeja">
		SELECT
			REQUERIMIENTO_NO_PROG.COD_RQTO_NO_PROG,
			REQUERIMIENTO_NO_PROG.FECH_REQU_SRM,
			MP2.NOMB_CORT_PER AS SOLICITANTE,
			DEPE2.UNIDAD_ORGANIZACIONAL||' '||DEPE2.DESC_DEPE_TDE AS UUOO_SOLICITANTE,
			REQUERIMIENTO_NO_PROG.MOTI_SOLI_SRM,
			REQUERIMIENTO_NO_PROG.CODI_RESP_SRM,
			REQUERIMIENTO_NO_PROG.CODI_DEPE_TDE,
			REQUERIMIENTO_NO_PROG_BIENES.CODI_BSER_CAT,
			CAT2.DESC_BSER_CAT AS DES_BBSS_NUEVO,
			REQUERIMIENTO_NO_PROG_BIENES.UNID_MEDI_DSR,
			UM1.UNID_MEDI_UND AS UM_NUEVO,
			REQUERIMIENTO_NO_PROG_BIENES.CANT_TOTA_DSR,
			REQUERIMIENTO_NO_PROG_BIENES.PUNI_NACI_DSR,
			(REQUERIMIENTO_NO_PROG_BIENES.CANT_TOTA_DSR * REQUERIMIENTO_NO_PROG_BIENES.PUNI_NACI_DSR) AS TOTAL, 
			REQUERIMIENTO_NO_PROG_BIENES.COD_ITEMORIGEN,
			CAT1.DESC_BSER_CAT AS DESC_BBSS_ORIGEN,
			UM2.UNID_MEDI_UND AS UM_ORIGEN,
			DEPE1.UNIDAD_ORGANIZACIONAL||' '||DEPE1.DESC_DEPE_TDE AS AUCT_MODIFICO,
			MP1.NOMB_CORT_PER AS USERMODIFICO,
			REQUERIMIENTO_NO_PROG_BIENES.FEC_ITEMMODIFICADO,
			REQUERIMIENTO_NO_PROG_BIENES.COD_AUCTMODIFICO,
			REQUERIMIENTO_NO_PROG_BIENES.COD_USERMODIFICO,
			REQUERIMIENTO_NO_PROG_BIENES.CODI_RQNP_SRM,
			REQUERIMIENTO_NO_PROG_BIENES.CLASIFICADOR,
			REQUERIMIENTO_NO_PROG_BIENES.IND_ESTADO,
			SYS_ESTADOS.DESC_REGI_EST,
			REQUERIMIENTO_NO_PROG_BIENES.OBS_RECHAZO,
			REQUERIMIENTO_NO_PROG_BIENES.IND_ESPECIALIZADO,
			(SELECT SER_RNP.FN_SALDO_CD (REQUERIMIENTO_NO_PROG.ANO_PROC_SRM,REQUERIMIENTO_NO_PROG.CODI_SEDE_SED,REQUERIMIENTO_NO_PROG_BIENES.CODI_BSER_CAT) AS RESULTADO FROM DUAL)  SALDO , 
			TDAUC.UNIDAD_ORGANIZACIONAL || ' - ' || TDAUC.ABREVIATURA NAME_AUCT,
			REQUERIMIENTO_NO_PROG_BIENES.NUM_ARCHIVO,
			NVL(REQUERIMIENTO_NO_PROG.ANN_ATENCION, REQUERIMIENTO_NO_PROG.ANO_PROC_SRM) ANN_ATENCION,
			DECODE (NVL(REQUERIMIENTO_NO_PROG.MES_ATENCION,REQUERIMIENTO_NO_PROG.MES_PROC_SRM ), '01', 'ENERO','02','FEBEREO','03','MARZO','04','ABRIL','05','MAYO','06','JUNIO','07','JULIO','08','AGOSTO','09','SEPTIEMBRE','10','OCTUBRE','11','NOVIEMBRE','12','DICIEMBRE' ) MES_ATENCION
		FROM 
			(SELECT RB.CODI_BSER_CAT, RB.UNID_MEDI_DSR, RB.CANT_TOTA_DSR, RB.PUNI_NACI_DSR, RB.COD_ITEMORIGEN,
	                RB.FEC_ITEMMODIFICADO, RB.COD_AUCTMODIFICO, RB.COD_USERMODIFICO, RB.CODI_RQNP_SRM, RB.CLASIFICADOR, RB.IND_ESTADO, RB.OBS_RECHAZO, 
	                RB.IND_ESPECIALIZADO, RB.COD_PLAZA, RB.NUM_ARCHIVO, RB.COD_AUCT1, RB.COD_JEFE
	            FROM REQUERIMIENTO_NO_PROG_BIENES RB 
	            WHERE RB.IND_ESTADO IN ('03','04')) 
	            REQUERIMIENTO_NO_PROG_BIENES,  
			REQUERIMIENTO_NO_PROG,
			CATALOGO_BIEN_SERVICIO CAT1,
			CATALOGO_BIEN_SERVICIO CAT2,
			UNIDADES_DE_MEDIDAS UM1,
			UNIDADES_DE_MEDIDAS UM2,
			TDEPENDENCIAS DEPE1,
			TDEPENDENCIAS DEPE2,
			MAESTRO_PERSONAL MP1,
			MAESTRO_PERSONAL MP2,
			TDEPENDENCIAS TDAUC,
			SYS_ESTADOS
		WHERE
			TDAUC.CODI_DEPE_TDE=REQUERIMIENTO_NO_PROG_BIENES.COD_AUCT1
			AND REQUERIMIENTO_NO_PROG_BIENES.CODI_RQNP_SRM = REQUERIMIENTO_NO_PROG.CODI_RQNP_SRM
			AND #cod_est# LIKE '%'||NVL(REQUERIMIENTO_NO_PROG_BIENES.IND_ESTADO,' ')||'%'   
			AND REQUERIMIENTO_NO_PROG_BIENES.CODI_BSER_CAT = CAT2.CODI_BSER_CAT
			AND REQUERIMIENTO_NO_PROG_BIENES.COD_ITEMORIGEN = CAT1.CODI_BSER_CAT
			AND CAT2.UNID_MUSO_CAT = UM1.CODI_MEDI_UND
			AND CAT1.UNID_MUSO_CAT = UM2.CODI_MEDI_UND
			AND REQUERIMIENTO_NO_PROG_BIENES.COD_AUCTMODIFICO = DEPE1.CODI_DEPE_TDE (+)
			AND REQUERIMIENTO_NO_PROG_BIENES.COD_USERMODIFICO = MP1.CODI_EMPL_PER (+)
			AND REQUERIMIENTO_NO_PROG.CODI_DEPE_TDE = DEPE2.CODI_DEPE_TDE
			AND REQUERIMIENTO_NO_PROG_BIENES.COD_JEFE = MP2.CODI_EMPL_PER
			AND SYS_ESTADOS.NOMB_TABL_EST = 'REQUERIMIENTO_NO_PROG_BIENES'
			AND REQUERIMIENTO_NO_PROG_BIENES.IND_ESTADO = SYS_ESTADOS.VALO_ESTA_EST
			<isNotNull prepend="AND" property="codEmpleadoJefe"> SER_RNP.FN_RESP_APROBADOR_AUC(REQUERIMIENTO_NO_PROG_BIENES.COD_AUCT1) = #codEmpleadoJefe#</isNotNull>
			<isNotNull prepend="AND" property="codEmpleadoEncargado"> SER_RNP.FN_RESP_APROBADOR_ENCARGADO_AU(REQUERIMIENTO_NO_PROG_BIENES.COD_AUCT1, #codEmpleadoEncargado#) = #codEmpleadoEncargado#</isNotNull>
			<!-- ORDER BY REQUERIMIENTO_NO_PROG.FECH_REQU_SRM DESC,SOLICITANTE DESC ,COD_RQTO_NO_PROG DESC ,DES_BBSS_NUEVO DESC -->
			ORDER BY REQUERIMIENTO_NO_PROG.CODI_RQNP_SRM DESC
	</select>


	<select id="selectUBG" parameterClass="java.util.HashMap" resultMap="lstbandeja">
		SELECT
			REQUERIMIENTO_NO_PROG.COD_RQTO_NO_PROG,
			REQUERIMIENTO_NO_PROG.FECH_REQU_SRM,
			MP2.NOMB_CORT_PER AS SOLICITANTE,
			DEPE2.UNIDAD_ORGANIZACIONAL||' '||DEPE2.DESC_DEPE_TDE AS UUOO_SOLICITANTE,
			REQUERIMIENTO_NO_PROG.MOTI_SOLI_SRM,
			REQUERIMIENTO_NO_PROG.CODI_RESP_SRM,
			REQUERIMIENTO_NO_PROG.CODI_DEPE_TDE,
			REQUERIMIENTO_NO_PROG_BIENES.CODI_BSER_CAT,
			CAT2.DESC_BSER_CAT AS DES_BBSS_NUEVO,
			REQUERIMIENTO_NO_PROG_BIENES.UNID_MEDI_DSR,
			UM1.UNID_MEDI_UND AS UM_NUEVO,
			REQUERIMIENTO_NO_PROG_BIENES.CANT_TOTA_DSR,
			REQUERIMIENTO_NO_PROG_BIENES.PUNI_NACI_DSR,
			(REQUERIMIENTO_NO_PROG_BIENES.CANT_TOTA_DSR * REQUERIMIENTO_NO_PROG_BIENES.PUNI_NACI_DSR) AS TOTAL, 
			REQUERIMIENTO_NO_PROG_BIENES.COD_ITEMORIGEN,
			CAT1.DESC_BSER_CAT AS DESC_BBSS_ORIGEN,
			UM2.UNID_MEDI_UND AS UM_ORIGEN,
			DEPE1.UNIDAD_ORGANIZACIONAL||' '||DEPE1.DESC_DEPE_TDE AS AUCT_MODIFICO,
			MP1.NOMB_CORT_PER AS USERMODIFICO,
			REQUERIMIENTO_NO_PROG_BIENES.FEC_ITEMMODIFICADO,
			REQUERIMIENTO_NO_PROG_BIENES.COD_AUCTMODIFICO,
			REQUERIMIENTO_NO_PROG_BIENES.COD_USERMODIFICO,
			REQUERIMIENTO_NO_PROG_BIENES.CODI_RQNP_SRM,
			REQUERIMIENTO_NO_PROG_BIENES.CLASIFICADOR,
			REQUERIMIENTO_NO_PROG_BIENES.IND_ESTADO,
			SYS_ESTADOS.DESC_REGI_EST,
			REQUERIMIENTO_NO_PROG_BIENES.OBS_RECHAZO,
			REQUERIMIENTO_NO_PROG_BIENES.IND_ESPECIALIZADO,
			(SELECT SER_RNP.FN_SALDO_CD (REQUERIMIENTO_NO_PROG.ANO_PROC_SRM,REQUERIMIENTO_NO_PROG.CODI_SEDE_SED,REQUERIMIENTO_NO_PROG_BIENES.CODI_BSER_CAT) AS RESULTADO FROM DUAL)  SALDO ,
			(SELECT UNIDAD_ORGANIZACIONAL || ' - ' || ABREVIATURA 		FROM TDEPENDENCIAS WHERE TDEPENDENCIAS.CODI_DEPE_TDE = REQUERIMIENTO_NO_PROG_BIENES.COD_AUCT1) NAME_AUCT,
			REQUERIMIENTO_NO_PROG_BIENES.NUM_ARCHIVO,
			NVL(REQUERIMIENTO_NO_PROG.ANN_ATENCION, REQUERIMIENTO_NO_PROG.ANO_PROC_SRM) ANN_ATENCION,
			DECODE (NVL(REQUERIMIENTO_NO_PROG.MES_ATENCION,REQUERIMIENTO_NO_PROG.MES_PROC_SRM ), '01', 'ENERO','02','FEBEREO','03','MARZO','04','ABRIL','05','MAYO','06','JUNIO','07','JULIO','08','AGOSTO','09','SEPTIEMBRE','10','OCTUBRE','11','NOVIEMBRE','12','DICIEMBRE' ) MES_ATENCION 
		FROM 
			REQUERIMIENTO_NO_PROG_BIENES,
			REQUERIMIENTO_NO_PROG,
			CATALOGO_BIEN_SERVICIO CAT1,
			CATALOGO_BIEN_SERVICIO CAT2,
			UNIDADES_DE_MEDIDAS UM1,
			UNIDADES_DE_MEDIDAS UM2,
			TDEPENDENCIAS DEPE1,
			TDEPENDENCIAS DEPE2,
			MAESTRO_PERSONAL MP1,
			MAESTRO_PERSONAL MP2,
			SYS_ESTADOS
		WHERE
			SER_RNP.FN_UUOO_UBG(REQUERIMIENTO_NO_PROG_BIENES.CODI_RQNP_SRM , REQUERIMIENTO_NO_PROG_BIENES.CODI_BSER_CAT)= #cod_dep#
			AND NVL(REQUERIMIENTO_NO_PROG_BIENES.IND_ESTADO,' ') LIKE #cod_est#
			AND REQUERIMIENTO_NO_PROG.ANO_PROC_SRM = #anio_act#
			AND REQUERIMIENTO_NO_PROG_BIENES.CODI_BSER_CAT = CAT2.CODI_BSER_CAT
			AND REQUERIMIENTO_NO_PROG_BIENES.COD_ITEMORIGEN = CAT1.CODI_BSER_CAT
			AND CAT2.UNID_MUSO_CAT = UM1.CODI_MEDI_UND
			AND CAT1.UNID_MUSO_CAT = UM2.CODI_MEDI_UND
			AND REQUERIMIENTO_NO_PROG_BIENES.COD_AUCTMODIFICO = DEPE1.CODI_DEPE_TDE (+)
			AND REQUERIMIENTO_NO_PROG_BIENES.COD_USERMODIFICO = MP1.CODI_EMPL_PER (+)
			AND REQUERIMIENTO_NO_PROG_BIENES.CODI_RQNP_SRM = REQUERIMIENTO_NO_PROG.CODI_RQNP_SRM 
			AND REQUERIMIENTO_NO_PROG.CODI_DEPE_TDE = DEPE2.CODI_DEPE_TDE
			AND REQUERIMIENTO_NO_PROG_BIENES.COD_JEFE = MP2.CODI_EMPL_PER
			AND SYS_ESTADOS.NOMB_TABL_EST = 'REQUERIMIENTO_NO_PROG_BIENES'
			AND REQUERIMIENTO_NO_PROG_BIENES.IND_ESTADO = SYS_ESTADOS.VALO_ESTA_EST
			ORDER BY REQUERIMIENTO_NO_PROG.FECH_REQU_SRM DESC,SOLICITANTE DESC ,COD_RQTO_NO_PROG DESC ,DES_BBSS_NUEVO DESC
	</select>


	<select id="selectOEC" parameterClass="java.util.HashMap" resultMap="lstbandeja">
		SELECT
			REQUERIMIENTO_NO_PROG.COD_RQTO_NO_PROG,
			REQUERIMIENTO_NO_PROG.FECH_REQU_SRM,
			MP2.NOMB_CORT_PER AS SOLICITANTE,
			DEPE2.UNIDAD_ORGANIZACIONAL||' '||DEPE2.DESC_DEPE_TDE AS UUOO_SOLICITANTE,
			REQUERIMIENTO_NO_PROG.MOTI_SOLI_SRM,
			REQUERIMIENTO_NO_PROG.CODI_RESP_SRM,
			REQUERIMIENTO_NO_PROG.CODI_DEPE_TDE,
			REQUERIMIENTO_NO_PROG_BIENES.CODI_BSER_CAT,
			CAT2.DESC_BSER_CAT AS DES_BBSS_NUEVO,
			REQUERIMIENTO_NO_PROG_BIENES.UNID_MEDI_DSR,
			UM1.UNID_MEDI_UND AS UM_NUEVO,
			REQUERIMIENTO_NO_PROG_BIENES.CANT_TOTA_DSR,
			REQUERIMIENTO_NO_PROG_BIENES.PUNI_NACI_DSR,
			(REQUERIMIENTO_NO_PROG_BIENES.CANT_TOTA_DSR * REQUERIMIENTO_NO_PROG_BIENES.PUNI_NACI_DSR) AS TOTAL, 
			REQUERIMIENTO_NO_PROG_BIENES.COD_ITEMORIGEN,
			CAT1.DESC_BSER_CAT AS DESC_BBSS_ORIGEN,
			UM2.UNID_MEDI_UND AS UM_ORIGEN,
			DEPE1.UNIDAD_ORGANIZACIONAL||' '||DEPE1.DESC_DEPE_TDE AS AUCT_MODIFICO,
			MP1.NOMB_CORT_PER AS USERMODIFICO,
			REQUERIMIENTO_NO_PROG_BIENES.FEC_ITEMMODIFICADO,
			REQUERIMIENTO_NO_PROG_BIENES.COD_AUCTMODIFICO,
			REQUERIMIENTO_NO_PROG_BIENES.COD_USERMODIFICO,
			REQUERIMIENTO_NO_PROG_BIENES.CODI_RQNP_SRM,
			REQUERIMIENTO_NO_PROG_BIENES.CLASIFICADOR,
			REQUERIMIENTO_NO_PROG_BIENES.IND_ESTADO,
			SYS_ESTADOS.DESC_REGI_EST,
			REQUERIMIENTO_NO_PROG_BIENES.OBS_RECHAZO,
			REQUERIMIENTO_NO_PROG_BIENES.IND_ESPECIALIZADO,
			(SELECT SER_RNP.FN_SALDO_CD (REQUERIMIENTO_NO_PROG.ANO_PROC_SRM,REQUERIMIENTO_NO_PROG.CODI_SEDE_SED,REQUERIMIENTO_NO_PROG_BIENES.CODI_BSER_CAT) AS RESULTADO FROM DUAL)  SALDO ,
			(SELECT UNIDAD_ORGANIZACIONAL || ' - ' || ABREVIATURA 		FROM TDEPENDENCIAS WHERE TDEPENDENCIAS.CODI_DEPE_TDE = REQUERIMIENTO_NO_PROG_BIENES.COD_AUCT1) NAME_AUCT,
			REQUERIMIENTO_NO_PROG_BIENES.NUM_ARCHIVO ,
			NVL(REQUERIMIENTO_NO_PROG.ANN_ATENCION, REQUERIMIENTO_NO_PROG.ANO_PROC_SRM) ANN_ATENCION,
			DECODE (NVL(REQUERIMIENTO_NO_PROG.MES_ATENCION,REQUERIMIENTO_NO_PROG.MES_PROC_SRM ), '01', 'ENERO','02','FEBEREO','03','MARZO','04','ABRIL','05','MAYO','06','JUNIO','07','JULIO','08','AGOSTO','09','SEPTIEMBRE','10','OCTUBRE','11','NOVIEMBRE','12','DICIEMBRE' ) MES_ATENCION 
		FROM 
			REQUERIMIENTO_NO_PROG_BIENES,
			REQUERIMIENTO_NO_PROG,
			CATALOGO_BIEN_SERVICIO CAT1,
			CATALOGO_BIEN_SERVICIO CAT2,
			UNIDADES_DE_MEDIDAS UM1,
			UNIDADES_DE_MEDIDAS UM2,
			TDEPENDENCIAS DEPE1,
			TDEPENDENCIAS DEPE2,
			MAESTRO_PERSONAL MP1,
			MAESTRO_PERSONAL MP2,
			SYS_ESTADOS
		WHERE
			REQUERIMIENTO_NO_PROG_BIENES.COD_UUOO_EXCESO = #cod_dep#
			AND NVL(REQUERIMIENTO_NO_PROG_BIENES.IND_ESTADO,' ') LIKE #cod_est#
			AND REQUERIMIENTO_NO_PROG.ANO_PROC_SRM = #anio_act#
			AND REQUERIMIENTO_NO_PROG_BIENES.CODI_BSER_CAT = CAT2.CODI_BSER_CAT
			AND REQUERIMIENTO_NO_PROG_BIENES.COD_ITEMORIGEN = CAT1.CODI_BSER_CAT
			AND CAT2.UNID_MUSO_CAT = UM1.CODI_MEDI_UND
			AND CAT1.UNID_MUSO_CAT = UM2.CODI_MEDI_UND
			AND REQUERIMIENTO_NO_PROG_BIENES.COD_AUCTMODIFICO = DEPE1.CODI_DEPE_TDE (+)
			AND REQUERIMIENTO_NO_PROG_BIENES.COD_USERMODIFICO = MP1.CODI_EMPL_PER (+)
			AND REQUERIMIENTO_NO_PROG_BIENES.CODI_RQNP_SRM = REQUERIMIENTO_NO_PROG.CODI_RQNP_SRM 
			AND REQUERIMIENTO_NO_PROG.CODI_DEPE_TDE = DEPE2.CODI_DEPE_TDE
			AND REQUERIMIENTO_NO_PROG_BIENES.COD_JEFE = MP2.CODI_EMPL_PER
			AND SYS_ESTADOS.NOMB_TABL_EST = 'REQUERIMIENTO_NO_PROG_BIENES'
			AND REQUERIMIENTO_NO_PROG_BIENES.IND_ESTADO = SYS_ESTADOS.VALO_ESTA_EST
			ORDER BY REQUERIMIENTO_NO_PROG.FECH_REQU_SRM DESC,SOLICITANTE DESC ,COD_RQTO_NO_PROG DESC ,DES_BBSS_NUEVO DESC
	</select>
	
	<select id="rqnp_ubg_dep" parameterClass="map" resultClass="java.lang.String">
		SELECT SIGA01.SER_RNP.FN_UOO_UBG_SOL_AUCT(#cod_rqnp#,#cod_bien#) AS RESULTADO FROM DUAL
	</select>


	<parameterMap id="sp_oec_parm"
		class="map">
		<parameter property="anio_pro" jdbcType="CHAR" javaType="java.lang.String"
			mode="IN" />
		<parameter property="cod_bien" jdbcType="CHAR" javaType="java.lang.String"
			mode="IN" />
		<parameter property="uuo_dep" jdbcType="CHAR" javaType="java.lang.String"
			mode="IN" />
		<parameter property="oec_ini" jdbcType="CHAR" javaType="java.lang.String"
			mode="IN" />
		<parameter property="cod_plaza" jdbcType="CHAR" javaType="java.lang.String"
			mode="OUT" />
		<parameter property="oec_sig" jdbcType="CHAR" javaType="java.lang.String"
			mode="OUT" />
		<parameter property="ind_fin" jdbcType="CHAR" javaType="java.lang.String"
			mode="OUT" />
		<parameter property="ind_saldo" jdbcType="CHAR" javaType="java.lang.String"
			mode="OUT" />
	</parameterMap>
	
	
	<procedure id="sp_oec" parameterMap="sp_oec_parm" >
		{call SIGA01.SER_RNP.SP_OEC(?,?,?,?,?,?,?,?)}
	</procedure>
	

	<select id="rqnp_oec_central" parameterClass="map" resultClass="java.lang.String">
			SELECT SIGA01.SER_RNP.FN_OEC_ESCENTRAL(#cod_oec#) AS RESULTADO FROM DUAL
	</select>
	
	<select id="rqnp_saldo_cd" parameterClass="map" resultClass="java.math.BigDecimal">
			SELECT SIGA01.SER_RNP.FN_SALDO_CD(#anio_pro#,#cod_plaza#, #cod_bien#) AS RESULTADO FROM DUAL
	</select>

	<select id="rqnp_obtener_indicador_oec" parameterClass="java.util.HashMap"	resultClass="java.lang.String">
		SELECT IND_AUTOMATICO 
		FROM BENEFICIARIOS
		WHERE COD_OEC=#cod_oec#
	</select>

	<select id="rqnp_obtener_dpg" parameterClass="map" resultClass="java.lang.String">
		SELECT DISTINCT TRIM(DESC_CORTA)    
		FROM T01PARAMETRO
		WHERE TRIM(COD_PARAMETRO) = #codParametro# 
		AND COD_MODULO = 'SIGA' 
		AND COD_TIPO = 'D' 
		AND TRIM(DESC_ABREVIATURA) =#descParametro#
	</select>
</sqlMap>

